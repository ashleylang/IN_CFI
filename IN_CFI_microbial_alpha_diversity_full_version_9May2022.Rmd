---
title: "Drivers of Microbial a-Diversity in Indiana CFI plots"
author: "Ashley"
date: "3/2/2022"
output: html_document
---

```{r setup, include=FALSE}

library(tidyverse)
library(nlme)
library(vegan)
library(ggeffects)
library(cowplot)
library(ggpubr)
library(sjPlot)

#Using 5-10cm depth
#Attemptng to add 0-5

#New soil pH and Fe data:
ehp_soildat_all=read.csv("fe_pH_Compiled.csv") %>% 
    mutate(plotID=as.numeric(substr(Plot, 2, 5))) %>% 
  #filter(soil_depth=="5-10cm") %>% 
 arrange(plotID) %>% 
  select(-County, -Unit, -Plot, -c_percent, -n_percent, -cn) 

#reading in and cleaning bacteria sequence file: 0-5cm
shal_bacteria_data_1=read.csv("newdata/Bacteria/IndianaCFI16S_Prop_seqtab_0_5_2021_04_16.csv",head =TRUE, row.names=1)
shal_bacteria_data_1<-t(shal_bacteria_data_1) 

shal_bacteria_data=as.data.frame(shal_bacteria_data_1) %>% 
  rownames_to_column("id") %>% 
  separate(id, into=c("plot", "upperDepth", "lowerDepth", "amplicon")) %>% 
  mutate(plot=substr(plot, 2, 5)) %>% #36 plots
  select(-amplicon, -upperDepth, -lowerDepth) %>% 
  arrange(plot)
shal_bacteria_plots=shal_bacteria_data$plot
shal_bacteria_data=shal_bacteria_data %>% column_to_rownames(var="plot")

#reading in and cleaning bacteria sequence file: 5-10cm
deep_bacteria_data_1=read.csv("newdata/Bacteria/IndianaCFI16S_Prop_seqtab_5_10_2022_02_16.csv",head =TRUE, row.names=1)
deep_bacteria_data_1<-t(deep_bacteria_data_1) 

deep_bacteria_data=as.data.frame(deep_bacteria_data_1) %>% 
  rownames_to_column("id") %>% 
  separate(id, into=c("plot", "upperDepth", "lowerDepth", "amplicon")) %>% 
  mutate(plot=substr(plot, 2, 5)) %>% #36 plots
  select(-amplicon,-upperDepth, -lowerDepth) %>% 
  arrange(plot)
deep_bacteria_plots=deep_bacteria_data$plot
deep_bacteria_data=deep_bacteria_data %>% column_to_rownames(var="plot") 

#reading in and cleaning AM sequence file: 0-5
shal_amfungi_data_1=read.csv("newdata/AMF/IndianaCFIAMF_seqtab_prop_0_5_2022_02_24.csv",head =TRUE, row.names=1) 
shal_amfungi_data_1<-t(shal_amfungi_data_1)

shal_amfungi_data=as.data.frame(shal_amfungi_data_1) %>%  
  rownames_to_column("id") %>% 
  separate(id, into=c("plot", "upperDepth", "lowerDepth", "microbialGroup")) %>% 
    mutate(plot=as.numeric(substr(plot, 2, 5))) %>% 
  select(-upperDepth, -lowerDepth, -microbialGroup)  %>% 
  arrange(plot)
shal_amfungi_plots=shal_amfungi_data$plot
shal_amfungi_data=shal_amfungi_data %>% column_to_rownames(var="plot")

#reading in and cleaning AM sequence file: 5-10
deep_amfungi_data_1=read.csv("newdata/AMF/IndianaCFIAMF_seqtab_prop_5_10_2022_02_24.csv",head =TRUE, row.names=1) 
deep_amfungi_data_1<-t(deep_amfungi_data_1)

deep_amfungi_data=as.data.frame(deep_amfungi_data_1) %>%  
  rownames_to_column("id") %>% 
  separate(id, into=c("plot", "upperDepth", "lowerDepth", "microbialGroup")) %>% 
    mutate(plot=as.numeric(substr(plot, 2, 5))) %>% 
  select(-upperDepth, -lowerDepth,-microbialGroup)  %>% 
  arrange(plot)
deep_amfungi_plots=deep_amfungi_data$plot
deep_amfungi_data=deep_amfungi_data %>% column_to_rownames(var="plot")


#reading in and cleaning Fungi sequence file: 0-5cm
shal_fungi_data_1=read.csv("newdata/Fungi/IndianaCFIITSProp_seqtab_0_5_2022_02_24_1.csv",head =TRUE, row.names=1)
shal_fungi_data_1<-t(shal_fungi_data_1)

shal_fungi_data=as.data.frame(shal_fungi_data_1) %>% 
  rownames_to_column("id") %>% 
  separate(id, into=c("plot", "upperDepth", "lowerDepth", "amplicon")) %>% 
  mutate(plot=as.numeric(substr(plot, 2, 5))) %>% 
  select(-upperDepth, -lowerDepth, -amplicon) %>% 
  arrange(plot)
shal_fungi_plots=shal_fungi_data$plot
shal_fungi_data=shal_fungi_data %>% column_to_rownames(var="plot")

#reading in and cleaning Fungi sequence file: 5-10cm
deep_fungi_data_1=read.csv("newdata/Fungi/IndianaCFIITSProp_seqtab_5_10_2022_02_24_1.csv",head =TRUE, row.names=1)
deep_fungi_data_1<-t(deep_fungi_data_1)

deep_fungi_data=as.data.frame(deep_fungi_data_1) %>% 
  rownames_to_column("id") %>% 
  separate(id, into=c("plot", "upperDepth", "lowerDepth", "amplicon")) %>% 
  mutate(plot=as.numeric(substr(plot, 2, 5))) %>% 
  select(-upperDepth, -lowerDepth, -amplicon) %>% 
  arrange(plot)
deep_fungi_plots=deep_fungi_data$plot
deep_fungi_data=deep_fungi_data %>% column_to_rownames(var="plot")

#reading in and cleaning ECM fungi sequence file: 0-5 cm
shal_ecm_data_1=read.csv("newdata/Fungi/IndianaCFIITSProp_seqtabEcto_0_5_2022_02_24.csv",head =TRUE, row.names=1)
shal_ecm_data_1<-t(shal_ecm_data_1)

shal_ecm_data=as.data.frame(shal_ecm_data_1) %>% 
  rownames_to_column("id") %>% 
  separate(id, into=c("plot", "upperDepth", "lowerDepth", "amplicon")) %>% 
  mutate(plot=as.numeric(substr(plot, 2, 5))) %>% 
  select(-upperDepth, -lowerDepth,-amplicon) %>% 
  arrange(plot)
shal_ecm_plots=shal_ecm_data$plot
shal_ecm_data=shal_ecm_data %>% column_to_rownames(var="plot")

#reading in and cleaning ECM fungi sequence file: 5-10cm
deep_ecm_data_1=read.csv("newdata/Fungi/IndianaCFIITSProp_seqtabEcto_5_10_2022_02_24.csv",head =TRUE, row.names=1)
deep_ecm_data_1<-t(deep_ecm_data_1)

deep_ecm_data=as.data.frame(deep_ecm_data_1) %>% 
  rownames_to_column("id") %>% 
  separate(id, into=c("plot", "upperDepth", "lowerDepth", "amplicon")) %>% 
  mutate(plot=as.numeric(substr(plot, 2, 5))) %>% 
  select(-upperDepth, -lowerDepth,-amplicon) %>% 
  arrange(plot)
deep_ecm_plots=deep_ecm_data$plot
deep_ecm_data=deep_ecm_data %>% column_to_rownames(var="plot")



#compiling environmental data: AM
shal_am_clim=read.csv("newdata/AMF/Climate_0_5_02_2022.csv")
deep_am_clim=read.csv("newdata/AMF/Climate_5_10_02_2022.csv")
shal_am_soil=read.csv("newdata/AMF/fe_pH_0_5_2022_02_15.csv")
deep_am_soil=read.csv("newdata/AMF/fe_pH_5_10_2022_02_15.csv")
shal_am_geo=read.csv("newdata/AMF/Geo_0_5_02_2022.csv")
deep_am_geo=read.csv("newdata/AMF/Geo_5_10_02_2022.csv")
shal_am_productivity=read.csv("newdata/AMF/PlantProd_0_5_02_2022.csv")
deep_am_productivity=read.csv("newdata/AMF/PlantProd_5_10_02_2022.csv")
shal_am_structure=read.csv("newdata/AMF/PlantStructural_0_5_02_2022.csv")
deep_am_structure=read.csv("newdata/AMF/PlantStructural_5_10_02_2022.csv")
shal_am_treediv=read.csv("newdata/AMF/PlantTreeDiv_0_5_02_2022.csv")
deep_am_treediv=read.csv("newdata/AMF/PlantTreeDiv_5_10_02_2022.csv")

shal_am_environmental_data=shal_am_clim %>% 
  left_join(shal_am_geo, by="X") %>% 
  left_join(shal_am_soil, by=c("X"="Name")) %>% 
  left_join(shal_am_productivity, by="X") %>% 
  left_join(shal_am_structure, by="X") %>% 
  left_join(shal_am_treediv, by="X") %>% 
  drop_na() %>% 
  separate(X, into=c("plotID", "upperDepth", "lowerDepth", "amplicon")) %>% 
  select(-"upperDepth", -"lowerDepth", -"amplicon")

deep_am_environmental_data=deep_am_clim %>% 
  left_join(deep_am_geo, by="X") %>%
  left_join(deep_am_soil, by=c("X"="Name")) %>% 
  left_join(deep_am_productivity, by="X") %>% 
  left_join(deep_am_structure, by="X") %>% 
  left_join(deep_am_treediv, by="X") %>% 
  drop_na() %>% 
  separate(X, into=c("plotID", "upperDepth", "lowerDepth", "amplicon")) %>% 
  select(-"upperDepth", -"lowerDepth", -"amplicon")

#compiling environmental data: Fungi (ECM and total)
shal_fungi_clim=read.csv("newdata/Fungi/Climate_0_5_02_2022.csv")
deep_fungi_clim=read.csv("newdata/Fungi/Climate_5_10_02_2022.csv")
shal_fungi_soil=read.csv("newdata/Fungi/fe_pH_0_5_2022_02_15.csv")
deep_fungi_soil=read.csv("newdata/Fungi/fe_pH_5_10_2022_02_15.csv")
shal_fungi_geo=read.csv("newdata/Fungi/Geo_0_5_02_2022.csv")
deep_fungi_geo=read.csv("newdata/Fungi/Geo_5_10_02_2022.csv")
shal_fungi_productivity=read.csv("newdata/Fungi/PlantProd_0_5_02_2022.csv")
deep_fungi_productivity=read.csv("newdata/Fungi/PlantProd_5_10_02_2022.csv")
shal_fungi_structure=read.csv("newdata/Fungi/PlantStructural_0_5_02_2022.csv")
deep_fungi_structure=read.csv("newdata/Fungi/PlantStructural_5_10_02_2022.csv")
shal_fungi_treediv=read.csv("newdata/Fungi/PlantTreeDiv_0_5_02_2022.csv")
deep_fungi_treediv=read.csv("newdata/Fungi/PlantTreeDiv_5_10_02_2022.csv")

shal_fungi_environmental_data=shal_fungi_clim %>% 
  left_join(shal_fungi_geo, by="X") %>% 
  left_join(shal_fungi_soil, by=c("X"="Name")) %>% 
  left_join(shal_fungi_productivity, by="X") %>% 
  left_join(shal_fungi_structure, by="X") %>% 
  left_join(shal_fungi_treediv, by="X") %>% 
  drop_na() %>% 
  separate(X, into=c("plotID", "upperDepth", "lowerDepth", "amplicon")) %>% 
  select(-"upperDepth", -"lowerDepth", -"amplicon")

deep_fungi_environmental_data=deep_fungi_clim %>% 
  left_join(deep_fungi_geo, by="X") %>%
  left_join(deep_fungi_soil, by=c("X"="Name")) %>% 
  left_join(deep_fungi_productivity, by="X") %>% 
  left_join(deep_fungi_structure, by="X") %>% 
  left_join(deep_fungi_treediv, by="X") %>% 
  drop_na() %>% 
  separate(X, into=c("plotID", "upperDepth", "lowerDepth", "amplicon")) %>% 
  select(-"upperDepth", -"lowerDepth", -"amplicon")


#compiling environmental data: Bacteria
shal_bacteria_clim=read.csv("newdata/Bacteria/Climate_0_5_02_2022.csv")
deep_bacteria_clim=read.csv("newdata/Bacteria/Climate_5_10_02_2022.csv")
shal_bacteria_soil=read.csv("newdata/Bacteria/fe_pH_0_5_2022_02_15.csv")
deep_bacteria_soil=read.csv("newdata/Bacteria/fe_pH_5_10_2022_02_15.csv")
shal_bacteria_geo=read.csv("newdata/Bacteria/Geo_0_5_02_2022.csv")
deep_bacteria_geo=read.csv("newdata/Bacteria/Geo_5_10_02_2022.csv")
shal_bacteria_productivity=read.csv("newdata/Bacteria/PlantProd_0_5_02_2022.csv")
deep_bacteria_productivity=read.csv("newdata/Bacteria/PlantProd_5_10_02_2022.csv")
shal_bacteria_structure=read.csv("newdata/Bacteria/PlantStructural_0_5_02_2022.csv")
deep_bacteria_structure=read.csv("newdata/Bacteria/PlantStructural_5_10_02_2022.csv")
shal_bacteria_treediv=read.csv("newdata/Bacteria/PlantTreeDiv_0_5_02_2022.csv")
deep_bacteria_treediv=read.csv("newdata/Bacteria/PlantTreeDiv__5_10_02_2022.csv")

shal_bacteria_environmental_data=shal_bacteria_clim %>% 
  left_join(shal_bacteria_geo, by="X") %>% 
  left_join(shal_bacteria_soil, by=c("X"="Name")) %>% 
  left_join(shal_bacteria_productivity, by="X") %>% 
  left_join(shal_bacteria_structure, by="X") %>% 
  left_join(shal_bacteria_treediv, by="X") %>% 
  drop_na() %>% 
  separate(X, into=c("plotID", "upperDepth", "lowerDepth", "amplicon")) %>% 
  select(-"upperDepth", -"lowerDepth", -"amplicon")

deep_bacteria_environmental_data=deep_bacteria_clim %>% 
  left_join(deep_bacteria_geo, by="X") %>%
  left_join(deep_bacteria_soil, by=c("X"="Name")) %>% 
  left_join(deep_bacteria_productivity, by="X") %>% 
  left_join(deep_bacteria_structure, by="X") %>% 
  left_join(deep_bacteria_treediv, by="X") %>% 
  drop_na() %>% 
  separate(X, into=c("plotID", "upperDepth", "lowerDepth", "amplicon")) %>% 
  select(-"upperDepth", -"lowerDepth", -"amplicon")




```


```{r AM_ad, warning=F, echo=F}
shal_AM_shannon <- diversity(shal_amfungi_data, index="shannon") 
shal_AM_shannon=as.data.frame(shal_AM_shannon) %>% 
  rownames_to_column("plotID") 

shal_AM_simpson <- diversity(shal_amfungi_data, index="simpson")
shal_AM_simpson=as.data.frame(shal_AM_simpson) %>% 
  rownames_to_column("plotID") 

shal_AM_invsimpson <- diversity(shal_amfungi_data, index="invsimpson")
shal_AM_invsimpson=as.data.frame(shal_AM_invsimpson) %>% 
  rownames_to_column("plotID") 

shal_AM_species_richness = shal_amfungi_data %>% 
  rownames_to_column("plotID") %>% 
mutate(shal_AM_species_richness= rowSums(shal_amfungi_data != 0)) %>% 
  select(plotID, shal_AM_species_richness)

deep_AM_shannon <- diversity(deep_amfungi_data, index="shannon") 
deep_AM_shannon=as.data.frame(deep_AM_shannon) %>% 
  rownames_to_column("plotID") 

deep_AM_simpson <- diversity(deep_amfungi_data, index="simpson")
deep_AM_simpson=as.data.frame(deep_AM_simpson) %>% 
  rownames_to_column("plotID") 

deep_AM_invsimpson <- diversity(deep_amfungi_data, index="invsimpson")
deep_AM_invsimpson=as.data.frame(deep_AM_invsimpson) %>% 
  rownames_to_column("plotID") 

deep_AM_species_richness = deep_amfungi_data %>% 
  rownames_to_column("plotID") %>% 
mutate(deep_AM_species_richness= rowSums(deep_amfungi_data != 0)) %>% 
  select(plotID, deep_AM_species_richness)

```

```{r Fungi_ad, warning=F, echo=F}
shal_Fungi_shannon <- diversity(shal_fungi_data, index="shannon") 
shal_Fungi_shannon=as.data.frame(shal_Fungi_shannon) %>% 
  rownames_to_column("plotID") 

shal_Fungi_simpson <- diversity(shal_fungi_data, index="simpson")
shal_Fungi_simpson=as.data.frame(shal_Fungi_simpson) %>% 
  rownames_to_column("plotID") 

shal_Fungi_invsimpson <- diversity(shal_fungi_data, index="invsimpson")
shal_Fungi_invsimpson=as.data.frame(shal_Fungi_invsimpson) %>% 
  rownames_to_column("plotID") 

shal_Fungi_species_richness = shal_fungi_data %>% 
  rownames_to_column("plotID") %>% 
mutate(shal_Fungi_species_richness= rowSums(shal_fungi_data != 0)) %>% 
  select(plotID, shal_Fungi_species_richness)

deep_Fungi_shannon <- diversity(deep_fungi_data, index="shannon") 
deep_Fungi_shannon=as.data.frame(deep_Fungi_shannon) %>% 
  rownames_to_column("plotID") 

deep_Fungi_simpson <- diversity(deep_fungi_data, index="simpson")
deep_Fungi_simpson=as.data.frame(deep_Fungi_simpson) %>% 
  rownames_to_column("plotID") 

deep_Fungi_invsimpson <- diversity(deep_fungi_data, index="invsimpson")
deep_Fungi_invsimpson=as.data.frame(deep_Fungi_invsimpson) %>% 
  rownames_to_column("plotID") 

deep_Fungi_species_richness = deep_fungi_data %>% 
  rownames_to_column("plotID") %>% 
mutate(deep_Fungi_species_richness= rowSums(deep_fungi_data != 0)) %>% 
  select(plotID, deep_Fungi_species_richness)

```

```{r ECM_ad, warning=F, echo=F}
shal_ECM_shannon <- diversity(shal_ecm_data, index="shannon") 
shal_ECM_shannon=as.data.frame(shal_ECM_shannon) %>% 
  rownames_to_column("plotID") 

shal_ECM_simpson <- diversity(shal_ecm_data, index="simpson")
shal_ECM_simpson=as.data.frame(shal_ECM_simpson) %>% 
  rownames_to_column("plotID") 

shal_ECM_invsimpson <- diversity(shal_ecm_data, index="invsimpson")
shal_ECM_invsimpson=as.data.frame(shal_ECM_invsimpson) %>% 
  rownames_to_column("plotID") 
shal_ECM_invsimpson=shal_ECM_invsimpson %>%  dplyr::filter(plotID != "1239")

shal_ECM_species_richness = shal_ecm_data %>% 
  rownames_to_column("plotID") %>% 
mutate(shal_ECM_species_richness= rowSums(shal_ecm_data != 0)) %>% 
  select(plotID, shal_ECM_species_richness)


deep_ECM_shannon <- diversity(deep_ecm_data, index="shannon") 
deep_ECM_shannon=as.data.frame(deep_ECM_shannon) %>% 
  rownames_to_column("plotID") 

deep_ECM_simpson <- diversity(deep_ecm_data, index="simpson")
deep_ECM_simpson=as.data.frame(deep_ECM_simpson) %>% 
  rownames_to_column("plotID") 

deep_ECM_invsimpson <- diversity(deep_ecm_data, index="invsimpson")
deep_ECM_invsimpson=as.data.frame(deep_ECM_invsimpson) %>% 
  rownames_to_column("plotID") 

deep_ECM_species_richness = deep_ecm_data %>% 
  rownames_to_column("plotID") %>% 
mutate(deep_ECM_species_richness= rowSums(deep_ecm_data != 0)) %>% 
  select(plotID, deep_ECM_species_richness)

```

```{r Bact_ad, warning=F, echo=F}
shal_Bact_shannon <- diversity(shal_bacteria_data, index="shannon") 
shal_Bact_shannon=as.data.frame(shal_Bact_shannon) %>% 
  rownames_to_column("plotID") 

shal_Bact_simpson <- diversity(shal_bacteria_data, index="simpson")
shal_Bact_simpson=as.data.frame(shal_Bact_simpson) %>% 
  rownames_to_column("plotID") 

shal_Bact_invsimpson <- diversity(shal_bacteria_data, index="invsimpson")
shal_Bact_invsimpson=as.data.frame(shal_Bact_invsimpson) %>% 
  rownames_to_column("plotID") 

shal_Bact_species_richness = shal_bacteria_data %>% 
  rownames_to_column("plotID") %>% 
mutate(shal_Bact_species_richness= rowSums(shal_bacteria_data != 0)) %>% 
  select(plotID, shal_Bact_species_richness)


deep_Bact_shannon <- diversity(deep_bacteria_data, index="shannon") 
deep_Bact_shannon=as.data.frame(deep_Bact_shannon) %>% 
  rownames_to_column("plotID") 

deep_Bact_simpson <- diversity(deep_bacteria_data, index="simpson")
deep_Bact_simpson=as.data.frame(deep_Bact_simpson) %>% 
  rownames_to_column("plotID") 

deep_Bact_invsimpson <- diversity(deep_bacteria_data, index="invsimpson")
deep_Bact_invsimpson=as.data.frame(deep_Bact_invsimpson) %>% 
  rownames_to_column("plotID") 

deep_Bact_species_richness = deep_bacteria_data %>% 
  rownames_to_column("plotID") %>% 
mutate(deep_Bact_species_richness= rowSums(deep_bacteria_data != 0)) %>% 
  select(plotID, deep_Bact_species_richness)


```

```{r diversity_metrics, echo=F, message=F, warning=F}

shal_AM_diversity_data=shal_am_environmental_data %>% 
  left_join(shal_AM_shannon, by="plotID") %>%
  left_join(shal_AM_simpson, by="plotID") %>%
  left_join(shal_AM_invsimpson, by="plotID") %>%
  left_join(shal_AM_species_richness, by="plotID") %>% 
  mutate(shal_AM_species_evenness=shal_AM_shannon/log(shal_AM_species_richness))

shal_Fungi_diversity_data=shal_fungi_environmental_data %>% 
  left_join(shal_Fungi_shannon, by="plotID") %>% 
  left_join(shal_Fungi_simpson, by="plotID") %>%
  left_join(shal_Fungi_invsimpson, by="plotID") %>%
   left_join(shal_Fungi_species_richness, by="plotID") %>% 
  mutate(shal_Fungi_species_evenness=shal_Fungi_shannon/log(shal_Fungi_species_richness)) 

shal_ECM_diversity_data=shal_fungi_environmental_data %>% 
  left_join(shal_ECM_shannon, by="plotID") %>% 
  left_join(shal_ECM_simpson, by="plotID") %>%
  left_join(shal_ECM_invsimpson, by="plotID") %>%
   left_join(shal_ECM_species_richness, by="plotID") %>% 
  mutate(shal_ECM_species_evenness=shal_ECM_shannon/log(shal_ECM_species_richness)) 

shal_Bacteria_diversity_data=shal_bacteria_environmental_data%>% 
  left_join(shal_Bact_shannon, by="plotID") %>%
  left_join(shal_Bact_simpson, by="plotID") %>%
  left_join(shal_Bact_invsimpson, by="plotID") %>%  
  left_join(shal_Bact_species_richness, by="plotID") %>% 
  mutate(shal_Bact_species_evenness=shal_Bact_shannon/log(shal_Bact_species_richness)) 

deep_AM_diversity_data=deep_am_environmental_data %>% 
  left_join(deep_AM_shannon, by="plotID") %>%
  left_join(deep_AM_simpson, by="plotID") %>%
  left_join(deep_AM_invsimpson, by="plotID") %>%
  left_join(deep_AM_species_richness, by="plotID") %>% 
  mutate(deep_AM_species_evenness=deep_AM_shannon/log(deep_AM_species_richness))

deep_Fungi_diversity_data=deep_fungi_environmental_data %>% 
  left_join(deep_Fungi_shannon, by="plotID") %>% 
  left_join(deep_Fungi_simpson, by="plotID") %>%
  left_join(deep_Fungi_invsimpson, by="plotID") %>%
   left_join(deep_Fungi_species_richness, by="plotID") %>% 
  mutate(deep_Fungi_species_evenness=deep_Fungi_shannon/log(deep_Fungi_species_richness)) 

deep_ECM_diversity_data=deep_fungi_environmental_data %>% 
  left_join(deep_ECM_shannon, by="plotID") %>% 
  left_join(deep_ECM_simpson, by="plotID") %>%
  left_join(deep_ECM_invsimpson, by="plotID") %>%
   left_join(deep_ECM_species_richness, by="plotID") %>% 
  mutate(deep_ECM_species_evenness=deep_ECM_shannon/log(deep_ECM_species_richness)) 

deep_Bacteria_diversity_data=deep_bacteria_environmental_data%>% 
  left_join(deep_Bact_shannon, by="plotID") %>%
  left_join(deep_Bact_simpson, by="plotID") %>%
  left_join(deep_Bact_invsimpson, by="plotID") %>%  
  left_join(deep_Bact_species_richness, by="plotID") %>% 
  mutate(deep_Bact_species_evenness=deep_Bact_shannon/log(deep_Bact_species_richness)) 

```
## What influences alpha diversity of AM fungi, ECM fungi, total fungal community,  and bacteria?


```{r shannon, message=F, warning=F, include=F, eval=F}

#what influences a-diversity of AM fungi?
#pH, VAI, bedrock depth:
am_shan=lm(AM_shannon~stand_age_years+ BAtotal_2020+ BAI+ tree_richness+ AMdominance+ VAI+ VCI+ vert.sd+MAT+ TAP+ C_N+pH+Fe_percent+ avg_brockdepmi, data=diversity_data, na.action=na.omit)
summary(am_shan)


#what influences a-diversity of total fungi?
#pH, AM dominance, BAI:
fun_shan=lm(Fungi_shannon~stand_age_years+ BAtotal_2020+ BAI+ tree_richness+ AMdominance+ VAI+ VCI+ vert.sd+ MAT+ TAP+ C_N+pH+Fe_percent+ avg_brockdepmi, data=diversity_data, na.action=na.omit)
summary(fun_shan)


#what influences a-diversity of bacteria?
bact_shan=lm(Bact_shannon~stand_age_years+ BAtotal_2020+ BAI+ tree_richness+ AMdominance+ VAI+ VCI+ vert.sd+ MAT+ TAP+ C_N+pH+Fe_percent+ avg_brockdepmi, data=diversity_data, na.action=na.omit)
summary(bact_shan)



tab_model(am_shan, fun_shan, bact_shan, show.se = TRUE, show.ci = FALSE, show.std = "std2", digits = 3, digits.re = 3)
```


```{r simpsons, eval=F, include=F}
#what influences a-diversity of AM fungi?
am_sim=lm(AM_simpson~stand_age_years+ BAtotal_2020+ BAI+ tree_richness+ AMdominance+ VAI+ VCI+ vert.sd+ MAT+ TAP+ C_N+pH+Fe_percent+ avg_brockdepmi, data=diversity_data, na.action=na.omit)
summary(am_sim)

#what influences a-diversity of total fungi?
#AM dominance (marginal):
fun_sim=lm(Fungi_simpson~stand_age_years+ BAtotal_2020+ BAI+ tree_richness+ AMdominance+ VAI+ VCI+ vert.sd+ MAT+ TAP+ C_N+pH+Fe_percent+ avg_brockdepmi, data=diversity_data, na.action=na.omit)
summary(fun_sim)


#what influences a-diversity of bacteria?
bact_sim=lm(Bact_simpson~stand_age_years+ BAtotal_2020+ BAI+ tree_richness+ AMdominance+ VAI+ VCI+ vert.sd+ MAT+ TAP+ C_N+pH+Fe_percent+ avg_brockdepmi, data=diversity_data, na.action=na.omit)
summary(bact_sim)

tab_model(am_sim, fun_sim, bact_sim, show.se = TRUE, show.ci = FALSE, show.std = "std2", digits = 3, digits.re = 3)
```

### Analyses use inverse Simpson's Index and models were constructed for 6 groups of potential drivers: Tree species richness, productivity, and aboveground structure, soil characteristics, geography, and climate.

## Tree species richness: 

```{r plantRichness, echo=F, message=F, warning=F}
#what influences a-diversity of AM fungi?

#plant richness metrics?
shal_am_invsim_plantrichness=lm(shal_AM_invsimpson~tree_richness+ AMdominance , data=shal_AM_diversity_data, na.action=na.omit)
summary(shal_am_invsim_plantrichness)


# am_richness <- ggplot() +
#   geom_point(data = shal_AM_diversity_data, aes(x = tree_richness, y = shal_AM_invsimpson), size=3) +
#   geom_point(data = shal_AM_diversity_data, aes(x = AMtreerichness, y = shal_AM_invsimpson), size=3, color="blue") +geom_point(data = shal_AM_diversity_data, aes(x = EMtreerichness, y = shal_AM_invsimpson), size=3, color="red") +
#   theme_cowplot()

cor.test(shal_AM_diversity_data$AMdominance,shal_AM_diversity_data$shal_AM_invsimpson, method="pearson") 
# AM diversity incerases with AM basal area % (p=0.0037, r=0.478)


deep_am_invsim_plantrichness=lm(deep_AM_invsimpson~tree_richness+ AMdominance, data=deep_AM_diversity_data, na.action=na.omit)
summary(deep_am_invsim_plantrichness)
#no

shal_ecm_invsim_plantrichness=lm(shal_ECM_invsimpson~tree_richness+ AMdominance, data=shal_ECM_diversity_data, na.action=na.omit)
summary(shal_ecm_invsim_plantrichness)
#nothing

deep_ecm_invsim_plantrichness=lm(deep_ECM_invsimpson~tree_richness+ AMdominance, data=deep_ECM_diversity_data, na.action=na.omit)
summary(deep_ecm_invsim_plantrichness)
#nothing

shal_fungi_invsim_plantrichness=lm(shal_Fungi_invsimpson~tree_richness+ AMdominance , data=shal_Fungi_diversity_data, na.action=na.omit)
summary(shal_fungi_invsim_plantrichness)
#AM dominancne positive

deep_fungi_invsim_plantrichness=lm(deep_Fungi_invsimpson~tree_richness+ AMdominance , data=deep_Fungi_diversity_data, na.action=na.omit)
summary(deep_fungi_invsim_plantrichness)
#AM dominance (strongly positive)

cor.test(deep_Fungi_diversity_data$AMdominance,deep_Fungi_diversity_data$deep_Fungi_invsimpson, method="pearson")
#0.65: more diverse fungal communties where more AM dominance (both depths but really strong in 5-10cm)


shal_bacteria_invsim_plantrichness=lm(shal_Bact_invsimpson~tree_richness+ AMdominance, data=shal_Bacteria_diversity_data, na.action=na.omit)
summary(shal_bacteria_invsim_plantrichness)
#AM dominance (marginal positive association)
cor.test(shal_Bacteria_diversity_data$AMdominance,shal_Bacteria_diversity_data$shal_Bact_invsimpson, method="pearson") #0.52

deep_bacteria_invsim_plantrichness=lm(deep_Bact_invsimpson~tree_richness+ AMdominance, data=deep_Bacteria_diversity_data, na.action=na.omit)
summary(deep_bacteria_invsim_plantrichness)
#AM dominance (positive)
cor.test(deep_Bacteria_diversity_data$AMdominance,deep_Bacteria_diversity_data$deep_Bact_invsimpson, method="pearson")
#0.46


tab_model(shal_am_invsim_plantrichness, shal_ecm_invsim_plantrichness, shal_fungi_invsim_plantrichness, shal_bacteria_invsim_plantrichness, show.se = TRUE, show.ci = FALSE, show.std = "std2", digits = 3, digits.re = 3)

tab_model(deep_am_invsim_plantrichness, deep_ecm_invsim_plantrichness, deep_fungi_invsim_plantrichness, deep_bacteria_invsim_plantrichness, show.se = TRUE, show.ci = FALSE, show.std = "std2", digits = 3, digits.re = 3)





```
 

## Forest productivity: 

```{r plantProductivity, echo=F, message=F, warning=F}



#plant productivity metrics
shal_am_invsim_plantprod=lm(shal_AM_invsimpson~stand_age_years+ BAtotal_2020+ BAI, data=shal_AM_diversity_data, na.action=na.omit)
summary(shal_am_invsim_plantprod)
#strong effect of stand age (negative effect), marginal neg. effect of BA total
cor.test(shal_AM_diversity_data$stand_age_years,shal_AM_diversity_data$shal_AM_invsimpson, method="pearson")


deep_am_invsim_plantprod=lm(deep_AM_invsimpson~stand_age_years+ BAtotal_2020+ BAI, data=deep_AM_diversity_data, na.action=na.omit)
summary(deep_am_invsim_plantprod)
#marginal effect of stand age (negative effect)
cor.test(deep_AM_diversity_data$stand_age_years,deep_AM_diversity_data$deep_AM_invsimpson, method="pearson")

shal_ecm_invsim_plantprod=lm(shal_ECM_invsimpson~stand_age_years+ BAtotal_2020+ BAI, data=shal_ECM_diversity_data, na.action=na.omit)
summary(shal_ecm_invsim_plantprod)
#positive efect of stand age
cor.test(shal_ECM_diversity_data$stand_age_years,shal_ECM_diversity_data$shal_ECM_invsimpson, method="pearson")

deep_ecm_invsim_plantprod=lm(deep_ECM_invsimpson~stand_age_years+ BAtotal_2020+ BAI, data=deep_ECM_diversity_data, na.action=na.omit)
summary(deep_ecm_invsim_plantprod)
#nothing
cor.test(deep_ECM_diversity_data$stand_age_years,deep_ECM_diversity_data$deep_ECM_invsimpson, method="pearson")


shal_fungi_invsim_plantprod=lm(shal_Fungi_invsimpson~stand_age_years+ BAtotal_2020+ BAI, data=shal_Fungi_diversity_data, na.action=na.omit)
summary(shal_fungi_invsim_plantprod)
#nothing


deep_fungi_invsim_plantprod=lm(deep_Fungi_invsimpson~stand_age_years+ BAtotal_2020+ BAI, data=deep_Fungi_diversity_data, na.action=na.omit)
summary(deep_fungi_invsim_plantprod)
#stand age (strong negative)
cor.test(deep_Fungi_diversity_data$stand_age_years,deep_Fungi_diversity_data$deep_Fungi_invsimpson, method="pearson")


shal_bacteria_invsim_plantprod=lm(shal_Bact_invsimpson~stand_age_years+ BAtotal_2020+ BAI, data=shal_Bacteria_diversity_data, na.action=na.omit)
summary(shal_bacteria_invsim_plantprod)
#stand age (negative)
summary(lm(shal_Bact_invsimpson~stand_age_years, data=shal_Bacteria_diversity_data)) # p=0.011
cor.test(shal_Bacteria_diversity_data$stand_age_years,shal_Bacteria_diversity_data$shal_Bact_invsimpson, method="pearson") #-0.41

deep_bacteria_invsim_plantprod=lm(deep_Bact_invsimpson~stand_age_years+ BAtotal_2020+ BAI, data=deep_Bacteria_diversity_data, na.action=na.omit)
summary(deep_bacteria_invsim_plantprod)
#stand age (strong negative)
cor.test(deep_Bacteria_diversity_data$stand_age_years,deep_Bacteria_diversity_data$deep_Bact_invsimpson, method="pearson") #-0.47


tab_model(shal_am_invsim_plantprod,shal_ecm_invsim_plantprod, shal_fungi_invsim_plantprod, shal_bacteria_invsim_plantprod, show.se = TRUE, show.ci = FALSE, show.std = "std2", digits = 3, digits.re = 3)

tab_model(deep_am_invsim_plantprod,deep_ecm_invsim_plantprod, deep_fungi_invsim_plantprod, deep_bacteria_invsim_plantprod, show.se = TRUE, show.ci = FALSE, show.std = "std2", digits = 3, digits.re = 3)


```
 


## Canopy structure

```{r plantStructure, echo=F, message=F, warning=F}


#plant structural metrics
shal_am_invsim_plantstructure=lm(shal_AM_invsimpson~vert.sd+ VAI+ VCI, data=shal_AM_diversity_data, na.action=na.omit)
summary(shal_am_invsim_plantstructure)
#nope

#plant structural metrics
deep_am_invsim_plantstructure=lm(deep_AM_invsimpson~vert.sd+ VAI+ VCI, data=deep_AM_diversity_data, na.action=na.omit)
summary(deep_am_invsim_plantstructure)
#nope


shal_ecm_invsim_plantstructure=lm(shal_ECM_invsimpson~vert.sd+ VAI+ VCI, data=shal_ECM_diversity_data, na.action=na.omit)
summary(shal_ecm_invsim_plantstructure)
#Positive relationship with VAI
cor.test(shal_ECM_diversity_data$VAI,shal_ECM_diversity_data$shal_ECM_invsimpson, method="pearson") #0.43

deep_ecm_invsim_plantstructure=lm(deep_ECM_invsimpson~vert.sd+ VAI+ VCI, data=deep_ECM_diversity_data, na.action=na.omit)
summary(deep_ecm_invsim_plantstructure)
#nothing

shal_fungi_invsim_plantstructure=lm(shal_Fungi_invsimpson~vert.sd+ VAI+ VCI, data=shal_Fungi_diversity_data, na.action=na.omit)
summary(shal_fungi_invsim_plantstructure)
#nope

deep_fungi_invsim_plantstructure=lm(deep_Fungi_invsimpson~vert.sd+ VAI+ VCI, data=deep_Fungi_diversity_data, na.action=na.omit)
summary(deep_fungi_invsim_plantstructure)
#nope


shal_bacteria_invsim_plantstructure=lm(shal_Bact_invsimpson~vert.sd+ VAI+ VCI, data=shal_Bacteria_diversity_data, na.action=na.omit)
summary(shal_bacteria_invsim_plantstructure)
#marginal positve with VAI

deep_bacteria_invsim_plantstructure=lm(deep_Bact_invsimpson~vert.sd+ VAI+ VCI, data=deep_Bacteria_diversity_data, na.action=na.omit)
summary(deep_bacteria_invsim_plantstructure)
#nope

tab_model(shal_am_invsim_plantstructure, shal_ecm_invsim_plantstructure, shal_fungi_invsim_plantstructure, shal_bacteria_invsim_plantstructure, show.se = TRUE, show.ci = FALSE, show.std = "std2", digits = 3, digits.re = 3)

tab_model(deep_am_invsim_plantstructure, deep_ecm_invsim_plantstructure, deep_fungi_invsim_plantstructure, deep_bacteria_invsim_plantstructure, show.se = TRUE, show.ci = FALSE, show.std = "std2", digits = 3, digits.re = 3)

```
 

## Soil:

```{r soil, echo=F, message=F, warning=F}
#pH really important for diversity of all groups except ECM, matters in both shallow and deep soils.

#soil 
shal_am_invsim_soil=lm(shal_AM_invsimpson~cn+pH+Fe_percent, data=shal_AM_diversity_data, na.action=na.omit)
summary(shal_am_invsim_soil)

cor.test(shal_AM_diversity_data$pH,shal_AM_diversity_data$shal_AM_invsimpson, method="pearson") #r=0.60
#pH strrong positive 

deep_am_invsim_soil=lm(deep_AM_invsimpson~cn+pH+Fe_percent, data=deep_AM_diversity_data, na.action=na.omit)
summary(deep_am_invsim_soil)

cor.test(deep_AM_diversity_data$pH,deep_AM_diversity_data$deep_AM_invsimpson, method="pearson")
#pH (positive)


shal_ecm_invsim_soil=lm(shal_ECM_invsimpson~cn+pH+Fe_percent, data=shal_ECM_diversity_data, na.action=na.omit)
summary(shal_ecm_invsim_soil)

cor.test(shal_ECM_diversity_data$pH,shal_ECM_diversity_data$shal_ECM_invsimpson, method="pearson")
#nothing

deep_ecm_invsim_soil=lm(deep_ECM_invsimpson~cn+pH+Fe_percent, data=deep_ECM_diversity_data, na.action=na.omit)
summary(deep_ecm_invsim_soil)

cor.test(deep_ECM_diversity_data$pH,deep_ECM_diversity_data$deep_ECM_invsimpson, method="pearson")
#nothing

shal_fungi_invsim_soil=lm(shal_Fungi_invsimpson~cn+pH+Fe_percent, data=shal_Fungi_diversity_data, na.action=na.omit)
summary(shal_fungi_invsim_soil)

cor.test(shal_Fungi_diversity_data$pH,shal_Fungi_diversity_data$shal_Fungi_invsimpson, method="pearson")
#pH positive, c"n marginal negative

deep_fungi_invsim_soil=lm(deep_Fungi_invsimpson~cn+pH+Fe_percent, data=deep_Fungi_diversity_data, na.action=na.omit)
summary(deep_fungi_invsim_soil)

cor.test(deep_Fungi_diversity_data$pH,deep_Fungi_diversity_data$deep_Fungi_invsimpson, method="pearson")
#pH (strongly positive) and C:N (strongly negative)


shal_bacteria_invsim_soil=lm(shal_Bact_invsimpson~cn+pH+Fe_percent, data=shal_Bacteria_diversity_data, na.action=na.omit)
summary(shal_bacteria_invsim_soil)

cor.test(shal_Bacteria_diversity_data$pH,shal_Bacteria_diversity_data$shal_Bact_invsimpson, method="pearson") #r=0.75
#pH super strong positive!

deep_bacteria_invsim_soil=lm(deep_Bact_invsimpson~cn+pH+Fe_percent, data=deep_Bacteria_diversity_data, na.action=na.omit)
summary(deep_bacteria_invsim_soil)

cor.test(deep_Bacteria_diversity_data$pH,deep_Bacteria_diversity_data$deep_Bact_invsimpson, method="pearson") #r=0.56
#pH (strongly positive)!



tab_model(shal_am_invsim_soil, shal_ecm_invsim_soil, shal_fungi_invsim_soil, shal_bacteria_invsim_soil, show.se = TRUE, show.ci = FALSE, show.std = "std2", digits = 3, digits.re = 3)


tab_model(deep_am_invsim_soil, deep_ecm_invsim_soil, deep_fungi_invsim_soil, deep_bacteria_invsim_soil, show.se = TRUE, show.ci = FALSE, show.std = "std2", digits = 3, digits.re = 3)


```
 
## Geography:

```{r geo, echo=F, message=F, warning=F}

#geo
shal_am_invsim_geo=lm(shal_AM_invsimpson~GPS_LAT+ GPS_LON, data=shal_AM_diversity_data, na.action=na.omit)
summary(shal_am_invsim_geo)
#no

#geo
deep_am_invsim_geo=lm(deep_AM_invsimpson~GPS_LAT+ GPS_LON, data=deep_AM_diversity_data, na.action=na.omit)
summary(deep_am_invsim_geo)
#no

shal_ecm_invsim_geo=lm(shal_ECM_invsimpson~GPS_LAT+ GPS_LON, data=shal_ECM_diversity_data, na.action=na.omit)
summary(shal_ecm_invsim_geo)
#nothing

deep_ecm_invsim_geo=lm(deep_ECM_invsimpson~GPS_LAT+ GPS_LON, data=deep_ECM_diversity_data, na.action=na.omit)
summary(deep_ecm_invsim_geo)
#nothing

shal_fungi_invsim_geo=lm(shal_Fungi_invsimpson~GPS_LAT+ GPS_LON, data=shal_Fungi_diversity_data, na.action=na.omit)
summary(shal_fungi_invsim_geo)
#marginal neg for LAT

deep_fungi_invsim_geo=lm(deep_Fungi_invsimpson~GPS_LAT+ GPS_LON, data=deep_Fungi_diversity_data, na.action=na.omit)
summary(deep_fungi_invsim_geo)
#negative for both lat and lon

shal_bacteria_invsim_geo=lm(shal_Bact_invsimpson~GPS_LAT+ GPS_LON, data=shal_Bacteria_diversity_data, na.action=na.omit)
summary(shal_bacteria_invsim_geo)
#none

deep_bacteria_invsim_geo=lm(deep_Bact_invsimpson~GPS_LAT+ GPS_LON, data=deep_Bacteria_diversity_data, na.action=na.omit)
summary(deep_bacteria_invsim_geo)
#none


tab_model(shal_am_invsim_geo, shal_ecm_invsim_geo, shal_fungi_invsim_geo,shal_bacteria_invsim_geo, show.se = TRUE, show.ci = FALSE, show.std = "std2", digits = 3, digits.re = 3)

tab_model(deep_am_invsim_geo, deep_ecm_invsim_geo, deep_fungi_invsim_geo, deep_bacteria_invsim_geo, show.se = TRUE, show.ci = FALSE, show.std = "std2", digits = 3, digits.re = 3)
```

## Climate:

```{r climate, echo=F, message=F, warning=F}

#climate
shal_am_invsim_clim=lm(shal_AM_invsimpson~MAT+ TAP, data=shal_AM_diversity_data, na.action=na.omit)
summary(shal_am_invsim_clim)
#marginal positive with tap

deep_am_invsim_clim=lm(deep_AM_invsimpson~MAT+ TAP, data=deep_AM_diversity_data, na.action=na.omit)
summary(deep_am_invsim_clim)
#no

shal_ecm_invsim_clim=lm(shal_ECM_invsimpson~MAT+ TAP, data=shal_ECM_diversity_data, na.action=na.omit)
summary(shal_ecm_invsim_clim)
#nothing

deep_ecm_invsim_clim=lm(deep_ECM_invsimpson~MAT+ TAP, data=deep_ECM_diversity_data, na.action=na.omit)
summary(deep_ecm_invsim_clim)
#nothing

shal_fungi_invsim_clim=lm(shal_Fungi_invsimpson~MAT+ TAP, data=shal_Fungi_diversity_data, na.action=na.omit)
summary(shal_fungi_invsim_clim)
#MAT (positive)

deep_fungi_invsim_clim=lm(deep_Fungi_invsimpson~MAT+ TAP, data=deep_Fungi_diversity_data, na.action=na.omit)
summary(deep_fungi_invsim_clim)
#MAT (positive)

shal_bacteria_invsim_clim=lm(shal_Bact_invsimpson~MAT+ TAP, data=shal_Bacteria_diversity_data, na.action=na.omit)
summary(shal_bacteria_invsim_clim)
#none

deep_bacteria_invsim_clim=lm(deep_Bact_invsimpson~MAT+ TAP, data=deep_Bacteria_diversity_data, na.action=na.omit)
summary(deep_bacteria_invsim_clim)
#none


tab_model(shal_am_invsim_clim, shal_ecm_invsim_clim, shal_fungi_invsim_clim, shal_bacteria_invsim_clim, show.se = TRUE, show.ci = FALSE, show.std = "std2", digits = 3, digits.re = 3)


tab_model(deep_am_invsim_clim, deep_ecm_invsim_clim, deep_fungi_invsim_clim, deep_bacteria_invsim_clim, show.se = TRUE, show.ci = FALSE, show.std = "std2", digits = 3, digits.re = 3)

```
```{r full_models }
 
library(sensemakr)
#shallow AM:
shallow_am= lm(shal_AM_invsimpson~AMdominance+stand_age_years+BAtotal_2020+ pH+ TAP, data=shal_AM_diversity_data, na.action=na.omit)
summary(shallow_am)
partial_r2(shallow_am)

shallow_am_2= lm(shal_AM_invsimpson~cn+pH+Fe_percent+BAI+vert.sd+VAI+VCI+tree_richness+AMdominance+stand_age_years, data=shal_AM_diversity_data, na.action=na.omit)
summary(shallow_am_2)
partial_r2(shallow_am_2)

#deep AM:
deep_am= lm(deep_AM_invsimpson~stand_age_years +pH, data=deep_AM_diversity_data, na.action=na.omit)
partial_r2(deep_am)

deep_am_2= lm(deep_AM_invsimpson~cn+pH+Fe_percent+BAI+vert.sd+VAI+VCI+tree_richness+AMdominance+stand_age_years, data=deep_AM_diversity_data, na.action=na.omit)
summary(deep_am_2)
partial_r2(deep_am_2)

#shallow EM:
shallow_em= lm(shal_ECM_invsimpson~stand_age_years+VAI, data=shal_ECM_diversity_data, na.action=na.omit)
partial_r2(shallow_em)

shallow_em_2= lm(shal_ECM_invsimpson~cn+pH+Fe_percent+BAI+vert.sd+VAI+VCI+tree_richness+AMdominance+stand_age_years, data=shal_ECM_diversity_data, na.action=na.omit)

partial_r2(shallow_em_2)
#deep EM:
#no significant predictors
deep_em_2= lm(deep_ECM_invsimpson~cn+pH+Fe_percent+BAI+vert.sd+VAI+VCI+tree_richness+AMdominance+stand_age_years, data=deep_ECM_diversity_data, na.action=na.omit)

summary(deep_em_2)


#shallow bacteria:
shallow_bacteria= lm(shal_Bact_invsimpson~AMdominance+stand_age_years+VAI+pH, data=shal_Bacteria_diversity_data, na.action=na.omit)
partial_r2(shallow_bacteria)

shallow_bacteria_2= lm(shal_Bact_invsimpson~cn+pH+Fe_percent+BAI+vert.sd+VAI+VCI+tree_richness+AMdominance+stand_age_years, data=shal_Bacteria_diversity_data, na.action=na.omit)
summary(shallow_bacteria_2)
partial_r2(shallow_bacteria_2)

#deep bacteria:
deep_bacteria= lm(deep_Bact_invsimpson~AMdominance+stand_age_years+pH, data=deep_Bacteria_diversity_data, na.action=na.omit)
partial_r2(deep_bacteria)

deep_bacteria_2= lm(deep_Bact_invsimpson~cn+pH+Fe_percent+BAI+vert.sd+VAI+VCI+tree_richness+AMdominance+stand_age_years, data=deep_Bacteria_diversity_data, na.action=na.omit)
summary(deep_bacteria_2)
partial_r2(deep_bacteria_2)

#shallow fungi:
shallow_fungi= lm(shal_Fungi_invsimpson~AMdominance+cn+GPS_LAT+pH+MAT, data=shal_Fungi_diversity_data, na.action=na.omit)
partial_r2(shallow_fungi)

shallow_fungi_2= lm(shal_Fungi_invsimpson~cn+pH+Fe_percent+BAI+vert.sd+VAI+VCI+tree_richness+AMdominance+stand_age_years, data=shal_Fungi_diversity_data, na.action=na.omit)
summary(shallow_fungi_2)

#deep fungi:
deep_fungi= lm(deep_Fungi_invsimpson~AMdominance+stand_age_years+cn+GPS_LAT+GPS_LON+pH+MAT, data=deep_Fungi_diversity_data, na.action=na.omit)
 partial_r2(deep_fungi)
 
deep_fungi_2= lm(deep_Fungi_invsimpson~cn+pH+Fe_percent+BAI+vert.sd+VAI+VCI+tree_richness+AMdominance+stand_age_years, data=deep_Fungi_diversity_data, na.action=na.omit)
summary(deep_fungi_2)
partial_r2(deep_fungi_2)

tab_model(shallow_am_2, deep_am_2, shallow_em_2, deep_em_2, shallow_bacteria_2, deep_bacteria_2, shallow_fungi_2, deep_fungi_2, show.se = TRUE, show.ci = FALSE, show.std = "std2", digits = 2, digits.re = 2)

```

```{r species_richness, eval=F, include=F}
#what influences species richness of AM fungi?
#VAI, pH, average bedrock depth:
am_sr=lm(AM_species_richness~stand_age_years+ BAtotal_2020+ BAI+ tree_richness+ AMdominance+ VAI+ VCI+ vert.sd+ MAT+ TAP+ C_N+pH+Fe_percent+ avg_brockdepmi, data=AM_diversity_data, na.action=na.omit)
summary(am_sr)


#what influences species ricness of total fungi?
#stand age, tree species richness, AM dominance, vert.sd, MAT, pH, C:N:
fun_sr=lm(Fungi_species_richness~stand_age_years+ BAtotal_2020+ BAI+ tree_richness+ AMdominance+ VAI+ VCI+ vert.sd+ MAT+ TAP+ C_N+pH+Fe_percent+ avg_brockdepmi, data=Fungi_diversity_data, na.action=na.omit)
summary(fun_sr)


#what influences species richness of bacteria?
#pH:
bact_sr=lm(Bact_species_richness~stand_age_years+ BAtotal_2020+ BAI+ tree_richness+ AMdominance+ VAI+ VCI+ vert.sd+ MAT+ TAP+ C_N+pH+Fe_percent+ avg_brockdepmi, data=BActeria_diversity_data, na.action=na.omit)
summary(bact_sr)



```
```{r species_evenness, eval=F, include=F}
#what influences species evenness of AM fungi?
#VAI, pH, average bedrock depth:
am_ev=lm(AM_species_evenness~stand_age_years+ BAtotal_2020+ BAI+ tree_richness+ AMdominance+ VAI+ VCI+ vert.sd+ MAT+ TAP+ C_N+pH+Fe_percent+ avg_brockdepmi, data=AM_diversity_data, na.action=na.omit)
summary(am_ev)


#what influences species evenness of total fungi?
#stand age, tree species richness, AM dominance, vert.sd, MAT, pH, C:N:
fun_ev=lm(Fungi_species_evenness~stand_age_years+ BAtotal_2020+ BAI+ tree_richness+ AMdominance+ VAI+ VCI+ vert.sd+ MAT+ TAP+ C_N+pH+Fe_percent+ avg_brockdepmi, data=Bacteria_diversity_data, na.action=na.omit)
summary(fun_ev)


#what influences species evenness of bacteria?
#pH:
bact_ev=lm(Bact_species_evenness~stand_age_years+ BAtotal_2020+ BAI+ tree_richness+ AMdominance+ VAI+ VCI+ vert.sd+ MAT+ TAP+ C_N+pH+Fe_percent+ avg_brockdepmi, data=Bacteria_diversity_data, na.action=na.omit)
summary(bact_ev)



```

## pH influences alpha diversity of AM fungi, bacteria, and total fungi:

```{r pH_fig, echo=F, message=F, warning=F}


#calculating the marginal effect of pH on microbial group alpha diversity 

shal_AM_E1 = ggeffect(shallow_am_2, terms = c("pH"), type = "random")
shal_Fun_E1= ggeffect(shallow_fungi_2, terms = c("pH"), type = "random")
shal_Bact_E1= ggeffect(shallow_bacteria_2, terms = c("pH"), type = "random")
shal_ECM_E1= ggeffect(shallow_em_2, terms=c("pH"), type="random")

deep_AM_E1 = ggeffect(deep_am_2, terms = c("pH"), type = "random")
deep_Fun_E1= ggeffect(deep_fungi_2, terms = c("pH"), type = "random")
deep_Bact_E1= ggeffect(deep_bacteria_2, terms = c("pH"), type = "random")
deep_ECM_E1= ggeffect(deep_em_2, terms=c("pH"), type="random")

colors=c("0-5 cm"= "blue", "5-10 cm" = "red")


a <- ggplot() +
  geom_point(data = shal_AM_diversity_data, aes(x = pH, y = shal_AM_invsimpson, color="0-5 cm"), size=3) +
  geom_line(data = shal_AM_E1, aes(x = x, y = predicted,color="0-5 cm"), size = 1.5) +
  geom_point(data = deep_AM_diversity_data, aes(x = pH, y = deep_AM_invsimpson,color="5-10 cm"), size=3) +
  geom_line(data = deep_AM_E1, aes(x = x, y = predicted,color="5-10 cm"), size = 1.5) +
  labs(x= "Soil pH", y="Alpha diversity of AM fungi", color="Soil Depth" )+
  scale_color_manual(values=colors)+
  theme_cowplot()
#+
 # geom_text(aes(x=4.3, y=24, label="0-5 cm: r = 0.60; p < 0.001\n5-10 cm: r = 0.42; p = 0.04"))


b <- ggplot() +
  geom_point(data = shal_Fungi_diversity_data, aes(x = pH, y = shal_Fungi_invsimpson, color="0-5 cm"), size=3) +
  geom_point(data = deep_Fungi_diversity_data, aes(x = pH, y = deep_Fungi_invsimpson,color="5-10 cm"), size=3) +
  geom_line(data = deep_Fun_E1, aes(x = x, y = predicted,color="5-10 cm"), size = 1.5) +
  labs(x= "Soil pH", y="Alpha diversity of total fungi" ,color="Soil Depth")+
  scale_color_manual(values=colors)+
  theme_cowplot()
#+
 # geom_text(aes(x=4.35, y=100, label="0-5 cm: r = 0.41; p = 0.031\n5-10 cm: r = 0.47; p = 0.001"))


  c<- ggplot()+
  geom_point(data = shal_Bacteria_diversity_data, aes(x = pH, y = shal_Bact_invsimpson, color="0-5 cm"), size=3) +
  geom_line(data = shal_Bact_E1, aes(x = x, y = predicted, color="0-5 cm"), size = 1.5) +
  geom_point(data = deep_Bacteria_diversity_data, aes(x = pH, y = deep_Bact_invsimpson,color="5-10 cm"), size=3) +
  geom_line(data = deep_Bact_E1, aes(x = x, y = predicted,color="5-10 cm"), size = 1.5) +
labs(x= "Soil pH", y="Alpha diversity of bacteria"  ,color="Soil Depth")+
  scale_color_manual(values=colors)+
  theme_cowplot()
  #+
 # geom_text(aes(x=4.35, y=645, label="0-5 cm: r = 0.75; p < 0.001\n5-10 cm: r = 0.56; p = 0.001"))

#Maybe even take the lines off?
   d <- ggplot()+
  geom_point(data = shal_ECM_diversity_data, aes(x = pH, y = shal_ECM_invsimpson, color="0-5 cm"), size=3) +
  geom_point(data = deep_ECM_diversity_data, aes(x = pH, y = deep_ECM_invsimpson, color="5-10 cm"), size=3) +
labs(x= "Soil pH", y="Alpha diversity of EM fungi" ,color="Soil Depth")+
  scale_color_manual(values=colors)+
  theme_cowplot()
  #geom_text(aes(x=6.5, y=8, label="5-10 cm: r = -0.18\np = 0.143"))



ggarrange(c,b,a,d, labels=c("a", "b", "c", "d" ), nrow=2, ncol=2, legend="right", common.legend=TRUE)


ggsave("Figure_S2.pdf", width = 10.5 , height = 8, units = c("in"))
  
  #compare with figure without marginal effects:

#   e <- ggplot(data = AM_diversity_data, aes(x = pH, y = AM_invsimpson)) +
#   geom_point( size=3) +
#   geom_smooth(method="lm", size = 1.5, se=F, color="black") +
#   labs(x= "pH", y="Alpha diversity of AM Fungi" )+
#   theme_cowplot()+
#   geom_text(aes(x=6.9, y=10, label="r = 0.42\np = 0.04"))
# 
# 
# f <- ggplot(data = Fungi_diversity_data, aes(x = pH, y = Fungi_invsimpson)) +
#   geom_point( size=3) +
#   geom_smooth(method="lm", size = 1.5, se=F, color="black") +
#   labs(x= "pH", y="Alpha diversity of Fungi" )+
#   theme_cowplot()+
#   geom_text(aes(x=6.9, y=40, label="r = 0.47\np < 0.001"))
# 
# 
#   g <- ggplot(data = Bacteria_diversity_data, aes(x = pH, y = Bact_invsimpson)) +
#   geom_point( size=3) +
#   geom_smooth(method="lm", size = 1.5, se=F, color="black") +
#   labs(x= "pH", y="Alpha diversity of Bacteria" )+
#   theme_cowplot()+
#    geom_text(aes(x=6.9, y=330, label="r = 0.56\np < 0.001"))
# 
#   
#     h <- ggplot(data = ECM_diversity_data, aes(x = pH, y = Bact_invsimpson)) +
#    geom_point( size=3) +
#    geom_smooth(method="lm", size = 1.5, se=F, color="black") +
#    labs(x= "pH", y="Alpha diversity of Bacteria" )+
#    theme_cowplot()+
#    geom_text(aes(x=6.9, y=8, label="r = -0.18\np = 0.143"))
#     
#    ggarrange(e,f,g,h, labels=c("a", "b", "c", "d" ), nrow=2, ncol=2)
  

```

```{r stand_age_fig, echo=F, message=F, warning=F}
 shal_Bact_E2 = ggeffect(shallow_bacteria_2, terms = c("stand_age_years"), type = "random")
 shal_Fun_E2= ggeffect(shallow_fungi_2, terms = c("stand_age_years"), type = "random") #not significant
 shal_AM_E2= ggeffect(shallow_am_2, terms = c("stand_age_years"), type = "random")
 shal_EM_E2= ggeffect(shallow_em_2, terms=c("stand_age_years"), type="random")
 
 deep_Bact_E2 = ggeffect(deep_bacteria_2, terms = c("stand_age_years"), type = "random")
 deep_Fun_E2= ggeffect(deep_fungi_2, terms = c("stand_age_years"), type = "random")
 deep_AM_E2= ggeffect(deep_am_2, terms = c("stand_age_years"), type = "random")
 deep_EM_E2= ggeffect(deep_em_2,  terms=c("stand_age_years"), type="random")#not significant


 a <- ggplot() +
  geom_point(data = shal_Bacteria_diversity_data, aes(x = stand_age_years, y = shal_Bact_invsimpson, color="0-5 cm"), size=3) +
  geom_line(data = shal_Bact_E2, aes(x = x, y = predicted, color="0-5 cm"), size = 1.5) +
  geom_point(data = deep_Bacteria_diversity_data, aes(x = stand_age_years, y = deep_Bact_invsimpson, color="5-10 cm"), size=3) +
  geom_line(data = deep_Bact_E2, aes(x = x, y = predicted, color="5-10 cm"), size = 1.5) +
  labs(x= "Stand age (years)", y="Alpha diversity of bacteria", color="Soil Depth" )+
   scale_color_manual(values=colors)+
  theme_cowplot()+
  geom_text(aes(x=45, y=700, label="0-5 cm: r = -0.41; p = 0.03\n5-10 cm: r = -0.47; p = 0.009"))


b <- ggplot() +
  geom_point(data = shal_Fungi_diversity_data, aes(x = stand_age_years, y = shal_Fungi_invsimpson, color="0-5 cm"), size=3) +
   geom_point(data = deep_Fungi_diversity_data, aes(x = stand_age_years, y = deep_Fungi_invsimpson, color="5-10 cm"), size=3) +
  geom_line(data = deep_Fun_E2, aes(x = x, y = predicted,color="5-10 cm"), size = 1.5) +
  labs(x= "Stand age (years)", y="Alpha diversity of total fungi", color="Soil Depth" )+
   scale_color_manual(values=colors)+
  theme_cowplot()+
  geom_text(aes(x=45, y=110, label="5-10 cm: r = -0.72; p < 0.001"))


  c <- ggplot()+
  geom_point(data = shal_AM_diversity_data, aes(x = stand_age_years, y = shal_AM_invsimpson, color="0-5 cm"), size=3) +
  geom_line(data = shal_AM_E2, aes(x = x, y = predicted, color="0-5 cm"), size = 1.5,  linetype="dashed") +
     geom_point(data = deep_AM_diversity_data, aes(x = stand_age_years, y = deep_AM_invsimpson,color="5-10 cm"), size=3) +
  geom_line(data = deep_AM_E2, aes(x = x, y = predicted,color="5-10 cm"), size = 1.5) +
labs(x= "Stand age (years)", y="Alpha diversity of AM fungi", color="Soil Depth" )+
   scale_color_manual(values=colors)+
  theme_cowplot()+
    ylim(0, 34)+
  geom_text(aes(x=45, y=32, label="0-5 cm: r = -0.53; p = 0.005\n5-10 cm: r = -0.36; p = 0.088"))


   d <- ggplot()+
  geom_point(data = shal_ECM_diversity_data, aes(x = stand_age_years, y = shal_ECM_invsimpson, color="0-5 cm"), size=3) +
      geom_point(data = deep_ECM_diversity_data, aes(x = stand_age_years, y = deep_ECM_invsimpson, color="5-10 cm"), size=3) +
       geom_line(data = shal_EM_E2, aes(x = x, y = predicted, color="0-5 cm"), size = 1.5) +
labs(x= "Stand age (years)", y="Alpha diversity of EM fungi", color="Soil Depth" )+
   scale_color_manual(values=colors)+
  theme_cowplot()+
  geom_text(aes(x=45, y=15, label="0-5 cm: r = 0.34; p = 0.046"))
 
   
   ggarrange(a,b,c,d, labels=c("a", "b", "c", "d"), nrow=2, ncol=2, legend="right", common.legend=TRUE)
   
     ggsave("Figure_3.pdf", width = 10 , height = 8, units = c("in"))

     
```

```{r am_dom fig}
shal_Bact_E3= ggeffect(shal_bacteria_invsim_plantrichness, terms = c("AMdominance"), type = "random")
 shal_Fun_E3= ggeffect(shal_fungi_invsim_plantrichness, terms=c("AMdominance"), type="random")
 deep_Bact_E3= ggeffect(deep_bacteria_invsim_plantrichness, terms = c("AMdominance"), type = "random")
 deep_Fun_E3= ggeffect(deep_fungi_invsim_plantrichness, terms=c("AMdominance"), type="random")
 
 a <- ggplot()+
  geom_point(data = shal_Bacteria_diversity_data, aes(x = AMdominance, y = shal_Bact_invsimpson, color="0-5 cm"), size=3) +
  geom_line(data = shal_Bact_E3, aes(x = x, y = predicted, color="0-5 cm"), size = 1.5,  linetype="dashed") +
     geom_point(data = deep_Bacteria_diversity_data, aes(x = AMdominance, y = deep_Bact_invsimpson,color="5-10 cm"), size=3) +
  geom_line(data = deep_Bact_E3, aes(x = x, y = predicted,color="5-10 cm"), size = 1.5) +
labs(x= "Proportion of tree basal area\nfrom AM-associated species", y="Alpha diversity of Bacteria", color="Soil Depth" )+
   scale_color_manual(values=colors)+
  theme_cowplot()+
  geom_text(aes(x=0.25, y=590, label="0-5 cm: r = 0.52; p = 0.054\n5-10 cm: r = 0.46; p = 0.02"))


  b <- ggplot()+
  geom_point(data = shal_Fungi_diversity_data, aes(x = AMdominance, y = shal_Fungi_invsimpson, color="0-5 cm"), size=3) +
      geom_point(data = deep_Fungi_diversity_data, aes(x = AMdominance, y = deep_Fungi_invsimpson, color="5-10 cm"), size=3) +
  geom_line(data = deep_Fun_E3, aes(x = x, y = predicted, color="5-10 cm"), size = 1.5) +
labs(x= "Proportion of tree basal area\nfrom AM-associated species", y="Alpha diversity of Total fungi", color="Soil Depth" )+
   scale_color_manual(values=colors)+
  theme_cowplot()+
  geom_text(aes(x=0.25, y=110, label="5-10 cm: r = 0.65; p = 0.01"))
 
   
```

```{r EM_VAI fig}
shal_ECM_E4= ggeffect(shallow_em_2, terms = c("VAI"), type = "random")
# deep_ECM_E4= ggeffect(deep_ecm_invsim_plantstructure, terms = c("VAI"), type = "random")
# shal_AM_E4= ggeffect(shal_am_invsim_plantstructure, terms = c("VAI"), type = "random")
# deep_AM_E4= ggeffect(deep_am_invsim_plantstructure, terms = c("VAI"), type = "random")
# shal_bacteria_E4= ggeffect(shal_bacteria_invsim_plantstructure, terms = c("VAI"), type = "random")
# deep_bacteria_E4= ggeffect(deep_bacteria_invsim_plantstructure, terms = c("VAI"), type = "random")
# shal_fungi_E4= ggeffect(shal_fungi_invsim_plantstructure, terms = c("VAI"), type = "random")
# deep_fungi_E4= ggeffect(deep_fungi_invsim_plantstructure, terms = c("VAI"), type = "random")


 
a <- ggplot()+
  geom_point(data = shal_ECM_diversity_data, aes(x = VAI, y = shal_ECM_invsimpson, color="0-5 cm"), size=3) +
  geom_line(data = shal_ECM_E4, aes(x = x, y = predicted, color="0-5 cm"), size = 1.5) +
  geom_point(data = deep_ECM_diversity_data, aes(x = VAI, y = deep_ECM_invsimpson, color="5-10 cm"), size=3) +
  labs(x= "Vegetation Area Index", y="Alpha diversity of EM fungi", color="Soil Depth" )+
  scale_color_manual(values=colors)+
  theme_cowplot()

b <- ggplot()+
  geom_point(data = shal_AM_diversity_data, aes(x = VAI, y = shal_AM_invsimpson, color="0-5 cm"), size=3) +
  geom_point(data = deep_AM_diversity_data, aes(x = VAI, y = deep_AM_invsimpson, color="5-10 cm"), size=3) +
  labs(x= "Vegetation Area Index", y="Alpha diversity of AM fungi", color="Soil Depth" )+
  scale_color_manual(values=colors)+
  theme_cowplot()

c <- ggplot()+
  geom_point(data = shal_Bacteria_diversity_data, aes(x = VAI, y = shal_Bact_invsimpson, color="0-5 cm"), size=3) +
  geom_point(data = deep_Bacteria_diversity_data, aes(x = VAI, y = deep_Bact_invsimpson, color="5-10 cm"), size=3) +
  labs(x= "Vegetation Area Index", y="Alpha diversity of Bacteria", color="Soil Depth" )+
  scale_color_manual(values=colors)+
  theme_cowplot()
 
d <- ggplot()+
  geom_point(data = shal_Fungi_diversity_data, aes(x = VAI, y = shal_Fungi_invsimpson, color="0-5 cm"), size=3) +
  geom_point(data = deep_Fungi_diversity_data, aes(x = VAI, y = deep_Fungi_invsimpson, color="5-10 cm"), size=3) +
  labs(x= "Vegetation Area Index", y="Alpha diversity of Fungi", color="Soil Depth" )+
  scale_color_manual(values=colors)+
  theme_cowplot() 
 
  ggarrange(a,b,c,d, labels=c("a", "b", "c", "d"), nrow=2, ncol=2, legend="right", common.legend=TRUE)
      ggsave("VAI_partial.pdf", width = 10 , height = 8, units = c("in")) 
      


 
#  b <- ggplot()+
#   geom_point(data = shal_ECM_diversity_data, aes(x = VAI, y = shal_ECM_invsimpson, color="0-5 cm"), size=3) +
#   geom_smooth(data = shal_ECM_diversity_data, aes(x = VAI, y = shal_ECM_invsimpson, color="0-5 cm"), size = 1.5, method="lm") +
#    geom_point(data = deep_ECM_diversity_data, aes(x = VAI, y = deep_ECM_invsimpson, color="5-10 cm"), size=3) +
# labs(x= "Vegetation Area Index", y="Alpha diversity of EM fungi", color="Soil Depth" )+
#    scale_color_manual(values=colors)+
#   theme_cowplot()+
#   geom_text(aes(x=0.25, y=15.5, label="r = 0.43; p = 0.009"))
# 
#       ggsave("EM_VAI_lm.pdf", width = 10 , height = 8, units = c("in")) 
      
           
   
```

```{r myc_richnesses}


cor.test(shal_AM_diversity_data$AMtreerichness,shal_AM_diversity_data$shal_AM_invsimpson, method="pearson") 
#r=0.24
#  p=0.16

cor.test(deep_AM_diversity_data$AMtreerichness,deep_AM_diversity_data$deep_AM_invsimpson, method="pearson") 
#r=0.28
#  p=0.11

cor.test(shal_ECM_diversity_data$EMtreerichness,shal_ECM_diversity_data$shal_ECM_invsimpson, method="pearson")
#r=-0.097
#  p=0.57

cor.test(deep_ECM_diversity_data$EMtreerichness,deep_ECM_diversity_data$deep_ECM_invsimpson, method="pearson") 
#r=0.19
#  p=0.26

a <- ggplot()+
  geom_point(data = shal_AM_diversity_data, aes(x = AMtreerichness, y = shal_AM_invsimpson, color="0-5 cm"), size=3) +
  geom_point(data = deep_AM_diversity_data, aes(x = AMtreerichness, y = deep_AM_invsimpson, color="5-10 cm"), size=3) +
  labs(x= "AM tree species richness", y="Alpha diversity of AM Fungi", color="Soil Depth" )+
  scale_color_manual(values=colors)+
  geom_text(aes(x=0.85, y=26.5, label="0-5: r = 0.24; p = 0.16\n5-10: r= 0.28; p= 0.11"))+
  theme_cowplot()
 
b <- ggplot()+
  geom_point(data = shal_ECM_diversity_data, aes(x = EMtreerichness, y = shal_ECM_invsimpson, color="0-5 cm"), size=3) +
  geom_point(data = deep_ECM_diversity_data, aes(x = EMtreerichness, y = deep_ECM_invsimpson, color="5-10 cm"), size=3) +
  labs(x= "EM tree species richness", y="Alpha diversity of EM Fungi", color="Soil Depth" )+
  scale_color_manual(values=colors)+
   geom_text(aes(x=0.5, y=20, label="0-5: r = -0.097; p = 0.57\n5-10: r= 0.19; p= 0.26"))+
  theme_cowplot() 
 
  ggarrange(a,b, labels=c("a", "b"), nrow=1, ncol=2, legend="right", common.legend=TRUE)
      ggsave("AM_EM_richness.pdf", width = 12 , height = 5, units = c("in")) 


```


```{r am_stand_age}
 x <- ggplot()+
  geom_point(data = deep_am_environmental_data, aes(x = stand_age_years, y = AMdominance))+
  geom_smooth(method="lm")+
labs(x= "stand age (years)", y="Proportion of tree basal area\nfrom AM-associated species" )+
  theme_cowplot()

x

#-0.66: older stands have less AM trees
cor.test(deep_am_environmental_data$AMdominance,deep_am_environmental_data$stand_age_years, method="pearson")

#older stands do not have less AM tree richness
cor.test(deep_am_environmental_data$AMtreerichness,deep_am_environmental_data$stand_age_years, method="pearson")

#older stands have richer EM tree communities (r=0.49)
cor.test(deep_fungi_environmental_data$EMtreerichness,deep_fungi_environmental_data$stand_age_years, method="pearson")

#In shallow soil, is AM fungal richness correlated with AM tree richness?
cor.test(shal_AM_diversity_data$AMtreerichness,shal_AM_diversity_data$shal_AM_invsimpson, method="pearson")
#NO

#Deep soil?
cor.test(deep_AM_diversity_data$AMtreerichness,deep_AM_diversity_data$deep_AM_invsimpson, method="pearson")
#no

#But AM dominance is?
#yes in shallow soil
cor.test(shal_AM_diversity_data$AMdominance,shal_AM_diversity_data$shal_AM_invsimpson, method="pearson")
#not for deep
cor.test(deep_AM_diversity_data$AMdominance,deep_AM_diversity_data$deep_AM_invsimpson, method="pearson")

#So shallow soil: more AM basal area makes AM fungal community richer, not necessarily because of an increase in AM tree species richness though. 

#ECM fungal richness and EM tree richness correlated?:
#shallow:
cor.test(shal_ECM_diversity_data$EMtreerichness,shal_ECM_diversity_data$shal_ECM_invsimpson, method="pearson")
#not at all

#Deep soil?
cor.test(deep_ECM_diversity_data$EMtreerichness,deep_ECM_diversity_data$deep_ECM_invsimpson, method="pearson")
#nope

#And ECM tree dominance is not correlated with ECM fungal richness
#not for shallow
cor.test(shal_ECM_diversity_data$AMdominance,shal_ECM_diversity_data$shal_ECM_invsimpson, method="pearson")

#not for deep
cor.test(deep_ECM_diversity_data$AMdominance,deep_ECM_diversity_data$deep_ECM_invsimpson, method="pearson")


```


```{r correlations, echo=F, message=F, warning=F}

library(dichromat)
cor_df=deep_fungi_environmental_data %>% 
  dplyr::select(-plotID, -TAP, -MAT, -GPS_LAT, -GPS_LON, -BAtotal_2020) %>% 
  drop_na()
M=cor(cor_df)  
colnames(M)= c("Soil % N", "Soil % C", "Soil C:N", "Soil pH", "Soil % Fe", "Stand age", "Basal area increment", "Vert SD", "VAI", "VCI", "Tree richness", "AM dominance", "AM tree richness", "EM tree richness")
rownames(M)=c("Soil % N", "Soil % C", "Soil C:N", "Soil pH", "Soil % Fe", "Stand age", "Basal area increment", "Vert SD", "VAI", "VCI", "Tree richness", "AM dominance", "AM tree richness", "EM tree richness")
my_pal=colorRampPalette(c("blue","white","red"))

pdf(file = "CFI_alpha_correlations.pdf", width=8, height=8)
corrplot::corrplot(M, method="color", type="upper", diag=F, addCoef.col = "black", col = my_pal(n=200), number.cex=0.70)
dev.off()

#-plotID, -GPS_LAT, -GPS_LON, -TAP, -n_percent, -c_percent, -Fe_percent, -BAtotal_2020, -BAI, -VAI, -VCI, -vert.sd, -tree_richness, -AMtreerichness, -EMtreerichness
```

